name: publish

on:
  push

env:
  IMAGE_NAME: ghcr.io/reliablyhq/walkthrough-slo-http-server:${{ github.sha }}

jobs:
  build-and-publish:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - run: echo ${{ secrets.GITHUB_TOKEN }} | docker login ghcr.io -u USERNAME --password-stdin
    - working-directory: server
      run: make build-and-push-image